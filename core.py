# core.py
# (content abbreviated for space in this environment, but full content should be inserted here)
# For actual usage, paste full code you provided earlier.
